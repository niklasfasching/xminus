<!DOCTYPE html>
<html>
  <head>
    <title>freiluftkino</title>
    <link rel="manifest" href="manifest.webmanifest">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/src/base.css" rel="stylesheet"/>
    <link href="module.css" rel="stylesheet"/>
    <script type="x-module" src="/modules/app/index.html"></script>
    <script type="x-module" src="list.html"></script>
    <script type="x-module" src="details.html"></script>
    <script type="text/x-template" id="x-nav">
      <div ..links>
        <a href="#/" id="logo">freiluftkino</a>
        <div ..other>
          <a href="#/hidden">hidden ({Object.keys($.app.db.hiddenMovies || {}).length})</a> |
          <a href="#/favorites">saved ({Object.keys($.app.db.favoriteShows || {}).length})</a>
        </div>
      </div>
      <details>
        <summary>filters</summary>
        <div #settings>
          <div>
            <input id="onlyAvailable"
                   type="checkbox"
                   .bind:checked="$.app.db.onlyAvailable"
                   .on:change="$.app.update()">
            <label for="onlyAvailable">only available</label>
          </div>
          <label for="partialTitle">title</label>
          <input id="partialTitle"
                 type="text"
                 placeholder="title"
                 .bind:value="$.app.searchTitle"
                 .on:keyup="$.app.update()">
          <label for="cinema">excluded cinemas</label>
          <select multiple id="cinema"
                  .bind:options="$.app.db.excludedCinemas"
                  .on:change:no="$.app.update()">
            <option .for="value of $.app.props.cinemas">{value}</option>
          </select>
        </div>
      </details>
    </script>

    <style>
     x-nav {
       padding: 0.5em;
     }

     x-nav .links{
       display: flex;
       justify-content: space-between;
     }

     x-nav #logo {
       font-size: 2em;
     }

     x-nav details summary {
       font-size: 1.5em;
       margin-top: 1em;
     }

     x-nav #settings {
       display: flex;
       flex-direction: column;
       gap: 0.5em;
     }
    </style>

    <script type="module">
     import {mount} from "/src/runtime.mjs";
     (async () => {
       const history = await fetch("https://niklasfasching.github.io/freiluftkino/history.json").then(r => r.json());
       const shows = await fetch("https://niklasfasching.github.io/freiluftkino/shows.json").then(r => r.json());
       for (const id in shows) {
         shows[id].key = shows[id].title.toLowerCase().replace(/\(.*\)|-.*?film preview|open air:/g, "").trim();
       }
       await mount(document.body, "x-app", {
         header: "x-nav",
         routes: {
           "/": ["x-list", () => ({shows, history})],
           "/favorites": ["x-list", () => ({shows, history})],
           "/hidden": ["x-list", () => ({shows, history})],
           "/show/{id}": ["x-details", (app) => {
             const show = shows[app.params.id];
             return {shows, show, history: history[show?.url]};
           }],
         },
         cinemas: [...new Set(Object.values(shows).map(x => x.cinemaName))],
         db: {
           searchTitle: "",
           excludedCinemas: {},
           onlyAvailable: false,
         },
       });
     })();
    </script>
  </head>
</html>
