{
  "bundler: rebaseModuleImports: should rewrite relative imports": {
    "module": [
      "import * from '/rebase/module.js';",
      "import * from '/rebase/dir/module.js';",
      "import * from '/rebase/base/module.js';",
      "import * from '/rebase/base/dir/module.js';",
      "import {foo, bar} from '/rebase/module.js';",
      "import * as module from '/rebase/module.js';",
      "import '/rebase/module.js';",
      ""
    ]
  },
  "bundler: rebaseModuleImports: should not modify absolute imports": {
    "module": [
      "import * from 'http://foo.bar/module.js';",
      "import {foo, bar} from 'http://foo.bar/module.js';",
      "import * as module from 'http://foo.bar/module.js';",
      "import 'http://foo.bar/module.js';",
      ""
    ]
  },
  "bundler: bundle: should bundle into an html file": {
    "html": [
      "<!DOCTYPE html>",
      "<html><head>",
      "<script type=\"module\">",
      "import {mount, hooks} from '/src/runtime.mjs';",
      "mount(document.body, \"x-main\", {foo: \"bar\"});",
      "hooks[\"x-main\"] = {};",
      "</script>",
      "<script type=\"module\">",
      "xm.components[\"x-main\"] = (function() {",
      "const _hooks = xm.hooks[\"x-main\"] || {};",
      "const _template = document.createElement(\"template\");",
      "_template.innerHTML = `",
      "<p><!----></p>",
      "<div><!---->: <!----></div>",
      "`;",
      "return function($, properties, _createChildren, $internal) {",
      "let {$path, $query, $update} = $internal;",
      "const _node = _template.content.cloneNode(true);",
      "$ = Object.create($);",
      "$ = Object.assign($, _hooks.create?.($, properties, $internal));",
      "const [$children, _childrenUpdate] = _createChildren?.($) || [];",
      "let _children_0_node = _node.firstChild;",
      "let _children_1_node = _children_0_node.nextSibling;",
      "let _children_2_node = _children_1_node.firstChild;",
      "let _children_4_node = _children_1_node;",
      "const _children_3_nodes = [_children_2_node], _children_3_values = [];",
      "xm.updateNodes(_children_4_node, null, _children_3_nodes, _children_3_values, [($.foo)], $, xm.createChildNode);",
      "let _children_5_node = _children_1_node.nextSibling;",
      "let _children_6_node = _children_5_node.nextSibling;",
      "let _children_7_node = _children_6_node.firstChild;",
      "let _children_9_node = _children_6_node;",
      "const _children_8_nodes = [_children_7_node,_children_7_node.nextSibling.nextSibling], _children_8_values = [];",
      "xm.updateNodes(_children_9_node, null, _children_8_nodes, _children_8_values, [($path),(\"{\" + Object.entries($query).map(([k,v]) => `${k}: ${v}`).join(\",\") + \"}\")], $, xm.createChildNode);",
      "let _children_10_node = _children_6_node.nextSibling;",
      "const _update = (_properties) => {",
      "({$path, $query, $update} = $internal);",
      "if (_properties) properties = _properties;",
      "_hooks.update?.($, properties, $internal);",
      "_childrenUpdate?.();",
      "xm.updateNodes(_children_4_node, null, _children_3_nodes, _children_3_values, [($.foo)], $, xm.createChildNode);",
      "xm.updateNodes(_children_9_node, null, _children_8_nodes, _children_8_values, [($path),(\"{\" + Object.entries($query).map(([k,v]) => `${k}: ${v}`).join(\",\") + \"}\")], $, xm.createChildNode);",
      "};",
      "return [new xm.Fragment(_node.childNodes), _update];",
      "};",
      "})();",
      "</script>",
      "<meta charset=\"utf-8\">",
      "</head>",
      "<body>",
      "</body></html>"
    ]
  },
  "bundler: bundle: should bundle into a data url": {
    "code": [
      "data:text/javascript,import \"data:text/javascript,//# sourceURL=xmComponents.js",
      "xm.components[\"x-main\"] = (function() {",
      "const _hooks = xm.hooks[\"x-main\"] || {};",
      "const _template = document.createElement(\"template\");",
      "_template.innerHTML = `",
      "<p><!----></p>",
      "<div><!---->: <!----></div>",
      "`;",
      "return function($, properties, _createChildren, $internal) {",
      "let {$path, $query, $update} = $internal;",
      "const _node = _template.content.cloneNode(true);",
      "$ = Object.create($);",
      "$ = Object.assign($, _hooks.create?.($, properties, $internal));",
      "const [$children, _childrenUpdate] = _createChildren?.($) || [];",
      "let _children_0_node = _node.firstChild;",
      "let _children_1_node = _children_0_node.nextSibling;",
      "let _children_2_node = _children_1_node.firstChild;",
      "let _children_4_node = _children_1_node;",
      "const _children_3_nodes = [_children_2_node], _children_3_values = [];",
      "xm.updateNodes(_children_4_node, null, _children_3_nodes, _children_3_values, [($.foo)], $, xm.createChildNode);",
      "let _children_5_node = _children_1_node.nextSibling;",
      "let _children_6_node = _children_5_node.nextSibling;",
      "let _children_7_node = _children_6_node.firstChild;",
      "let _children_9_node = _children_6_node;",
      "const _children_8_nodes = [_children_7_node,_children_7_node.nextSibling.nextSibling], _children_8_values = [];",
      "xm.updateNodes(_children_9_node, null, _children_8_nodes, _children_8_values, [($path),(\"{\" + Object.entries($query).map(([k,v]) => `${k}: ${v}`).join(\",\") + \"}\")], $, xm.createChildNode);",
      "let _children_10_node = _children_6_node.nextSibling;",
      "const _update = (_properties) => {",
      "({$path, $query, $update} = $internal);",
      "if (_properties) properties = _properties;",
      "_hooks.update?.($, properties, $internal);",
      "_childrenUpdate?.();",
      "xm.updateNodes(_children_4_node, null, _children_3_nodes, _children_3_values, [($.foo)], $, xm.createChildNode);",
      "xm.updateNodes(_children_9_node, null, _children_8_nodes, _children_8_values, [($path),(\"{\" + Object.entries($query).map(([k,v]) => `${k}: ${v}`).join(\",\") + \"}\")], $, xm.createChildNode);",
      "};",
      "return [new xm.Fragment(_node.childNodes), _update];",
      "};",
      "})();",
      "\";"
    ]
  }
}
